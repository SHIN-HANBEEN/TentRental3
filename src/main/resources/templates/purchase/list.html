<head>
<style>
    /* For Sundays */
    .fc-day-sun {
        color: red; /* Change the color to your desired value */
    }

    /* For Saturdays */
    .fc-day-sat {
        color: blue; /* Change the color to your desired value */
    }
</style>
    <meta charset='utf-8' />
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- bootstrap 4 -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link th:href="@{/css/main.css}" rel="stylesheet"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.0/main.min.js"></script>
	
    <script th:inline="javascript">
		document.addEventListener('DOMContentLoaded', function(){
			var calendar1 = document.getElementById('calendar');
			var calendar = new FullCalendar.Calendar(calendar1,{
				initialView: 'dayGridMonth',
				 headerToolbar:{
				  left: 'addListButton',
				  center: 'title',
				  right: 'today,prevYear,prev,next,nextYear'
			  },
			  customButtons: {
				  addListButton: {
					  text: "목록으로돌아가기",
					  click: function(){
						window.location.href = "/board/list";
				  }
			  }
		  },
		  buttonText: {
			  today: "오늘"
		  },
		  displayEventTime: false,
			locale: "ko",
	        height: '780px', // calendar 높이 설정
	        expandRows: true,
 	        fixedWeekCount: false,
//	        showNonCurrentDates: false,
	        datesSet: function(view) {
	        
	            console.log('날짜 범위가 변경되었습니다.', view.start, view.end);
	            //이벤트 등록 함수 호출
	            reset();
	            eventRegister();
	        },
		  
			});
			 calendar.render();   
		}
		);
		function reset() {
    	  const tds = document.querySelectorAll("td.fc-daygrid-day");
    	  for(i in tds){
    		  if(!isNaN(i)){
    			  const td = tds[i];
      			if(td.childNodes[0].childNodes[1].childNodes[0]!=undefined){
      				td.childNodes[0].childNodes[1].childNodes[0].innerHTML = '';
      			} 
    		  }	 
    	  }
      }
      
      function eventRegister(){
		  
		  let pcsArray = new Array();
		  let pcsArrayList = [[${list}]];
		  let pcs = new Object();
		  
		 /*[# th:each="dto : ${list}"]*/
          pcs.no = /*[[${dto.pcsNo}]]*/
          pcs.goodsName = /*[[${dto.goodsName}]]*/
          pcs.start = /*[[${dto.pcsStartDate}]]*/
          pcs.end = /*[[${dto.pcsEndDate}]]*/
          pcsArray.push(pcs);
          /*[/]*/
          
          let noArray = new Array();
          
          console.log(pcsArrayList);
          console.log(pcsArray);
		  
		  const tds = document.querySelectorAll("td.fc-daygrid-day");
		  
		  for (i in tds) {
		    const td = tds[i];
		    for (let i = 0; i < pcsArray.length; i++) {
		        if (td instanceof HTMLElement) {
		            const startDate = new Date(pcsArrayList.content[i].pcsStartDate);
		            const endDate = new Date(pcsArrayList.content[i].pcsEndDate);
		            const currentDate = new Date(td.getAttribute("data-date"));
		
		            if (currentDate >= startDate && currentDate <= endDate) {
		                let span = '<a href=""></a>';
		                let linkUrl = '/purchase/read?goodsNo=' + pcsArrayList.content[i].goodsNo +"&pcsNo="+pcsArrayList.content[i].pcsNo +"&pcsStartDate=" + pcsArrayList.content[i].pcsStartDate + "&pcsEndDate=" + pcsArrayList.content[i].pcsEndDate + "&explanation=" + pcsArrayList.content[i].explanation;
		                let linkText = pcsArrayList.content[i].goodsName.substring(0, 12);
		                if (pcsArrayList.content[i].goodsName.length > 12) {
		                    linkText += '...';
		                }
		                
		                let linkElement = document.createElement('a');
		                linkElement.href = linkUrl;
		                linkElement.textContent = linkText;
		                linkElement.style.fontSize = '14px';
		                linkElement.style.color = 'black';
		                linkElement.style.backgroundColor = 'rgb(142, 175, 129)';
		                linkElement.style.border = '1px solid white';
		                linkElement.style.textAlign = 'center';
		                linkElement.style.width = '100%';
		                linkElement.style.textDecoration = 'none';
		                linkElement.style.display = 'inline-block';
		                linkElement.style.fontWeight = 'bold';
		                span = linkElement.outerHTML;
		
		               if (td.childNodes[0].childNodes[1].childNodes[0].innerHTML != null) {
		                    let ori = td.childNodes[0].childNodes[1].childNodes[0].innerHTML;
		                    td.childNodes[0].childNodes[1].childNodes[0].innerHTML = ori + span;
		                } else {
		                    td.childNodes[0].childNodes[1].childNodes[0].innerHTML = span;
		                }
		            }
		        } else {
		            return;
		        }
		  }
	  }
	  }

	</script>
		
  </head>
		<th:block th:replace="layout/base :: setContent(~{this::content} )">
		<th:block th:fragment="content">

		    <div id='calendar' style="margin-top: 33px"></div>
		 
		   <div class="d-flex justify-content-start align-items-center">     
		        	<span>
		                <a th:href="@{/board/list}">
		                    <button sec:authorize="hasRole('ROLE_ADMIN')" type="button" class="btn btn-outline-primary" style="color: black;background-color: white; border-color: rgb(44,62,80);margin: 12px 1px 1px 1px;">돌아가기</button>
		                </a>
		            </span>

					</form>
		    </div>	
		 
		</th:block>
		</th:block>